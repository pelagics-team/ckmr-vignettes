<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CKMR – coding_tips</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">CKMR</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../tutorials/about.html">About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../tutorials/coding_tips.html" aria-current="page">Tips</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tutorials/fit_delfi_A_vignette.html">Delfi A</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#offarrays" id="toc-offarrays" class="nav-link active" data-scroll-target="#offarrays">Offarrays</a>
  <ul class="collapse">
  <li><a href="#summary-operations-on-offarray-objects" id="toc-summary-operations-on-offarray-objects" class="nav-link" data-scroll-target="#summary-operations-on-offarray-objects">Summary operations on <code>offarray</code> objects</a></li>
  </ul></li>
  <li><a href="#autoloop" id="toc-autoloop" class="nav-link" data-scroll-target="#autoloop">Autoloop</a></li>
  <li><a href="#environments" id="toc-environments" class="nav-link" data-scroll-target="#environments">Environments</a></li>
  <li><a href="#common-errors" id="toc-common-errors" class="nav-link" data-scroll-target="#common-errors">Common errors</a>
  <ul class="collapse">
  <li><a href="#turning-off-the-byte-compiler" id="toc-turning-off-the-byte-compiler" class="nav-link" data-scroll-target="#turning-off-the-byte-compiler">Turning-off the byte compiler</a></li>
  <li><a href="#atease" id="toc-atease" class="nav-link" data-scroll-target="#atease">atease</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<p><br> The exercises use R functions and object classes from R libraries that were developed specifically for CKMR. As such, some of the syntax might look unfamiliar. We review here key functions or coding concepts used throughout the exercises, but please see the <a href="https://github.com/markbravington/csiro22/blob/main/Rcrib22.pdf">Rcrib.pdf</a> document for a more thorough description.</p>
<section id="offarrays" class="level1">
<h1>Offarrays</h1>
<p><code>offarray</code> is an object class defined by the library <code>offarray</code>, which allows to create arrays that are indexed by the name of their dimensions instead of the cell position. This eases the task of querying specific dimensions, as there is no need to map the desired level (say, 2015) to its position in the array dimension (“4”, if the year dimension goes from 2012 to 2018).</p>
<p>For instance,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(offarray)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>oasmp <span class="ot">&lt;-</span> <span class="fu">offarray</span>(<span class="fu">round</span>(<span class="fu">runif</span>(<span class="dv">16</span>),<span class="dv">1</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">first=</span><span class="fu">c</span>(<span class="at">Y=</span><span class="dv">2012</span>, <span class="at">B=</span><span class="dv">2005</span>), <span class="at">last=</span><span class="fu">c</span>(<span class="at">Y=</span><span class="dv">2015</span>, <span class="at">B=</span><span class="dv">2008</span>))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>oasmp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         B
Y         [,2005] [,2006] [,2007] [,2008]
  [2012,]     0.3     0.8     0.4     0.1
  [2013,]     1.0     0.6     0.8     0.4
  [2014,]     0.9     0.1     0.2     0.3
  [2015,]     0.5     0.3     0.2     0.5</code></pre>
</div>
</div>
<p>will create an <code>offarray</code> of dimensions <code>Y</code> going from 2012 to 2015 and <code>B</code> going from 2005 to 2008. To query the value for <code>Y=2014</code> and <code>B=2007</code>, just specify these levels directly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>oasmp[<span class="dv">2014</span>, <span class="dv">2007</span>] <span class="co"># this wouldn't work with a normal array object!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         B
Y         [,2007]
  [2014,]     0.2</code></pre>
</div>
</div>
<p>The function <code>dimseq</code> will print the dimensions of an <code>offarray</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimseq</span>(oasmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Y
[1] 2012 2013 2014 2015

$B
[1] 2005 2006 2007 2008</code></pre>
</div>
</div>
<p>It is also very easy to create an <code>offarray</code> from an object of <code>table</code> class, in which case the <code>offarray</code> dimension will be set directly from the table’s <code>dimnames</code>. That is how it is most often used in the exercise code, e.g.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>oatbl <span class="ot">&lt;-</span> <span class="fu">offarray</span>(<span class="fu">table</span>(<span class="at">A=</span><span class="fu">rpois</span>(<span class="dv">12</span>, <span class="dv">20</span>)))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dimseq</span>(oatbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 16 17 18 19 20 21 22 23 24 25 26</code></pre>
</div>
</div>
<section id="summary-operations-on-offarray-objects" class="level2">
<h2 class="anchored" data-anchor-id="summary-operations-on-offarray-objects">Summary operations on <code>offarray</code> objects</h2>
<p>A common operation (in CKMR and elsewhere) is to apply a function (e.g., the sum) over a specific dimension of an array. In base R the main function to do this is <code>apply</code>, e.g.,</p>
<p><code>apply(myoa, 1, sum)</code></p>
<p>would sum the values in <code>myoa</code> by rows. To do this with <code>offarray</code> objects you need to convert them to arrays first, e.g.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">as.array</span>(oasmp), <span class="dv">1</span>, sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2012 2013 2014 2015 
 1.6  2.8  1.5  1.5 </code></pre>
</div>
</div>
<p>If the aggregation function is a sum (often the case with CKMR), another option is to use the <code>sumover</code> function which was designed specifically for offarrays.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sumover</span>(oasmp, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>B
[2005] [2006] [2007] [2008] 
   2.7    1.8    1.6    1.3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sumover</span>(oasmp, <span class="st">'B'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Y
[2012] [2013] [2014] [2015] 
   1.6    2.8    1.5    1.5 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sumover</span>(oasmp, <span class="st">'Y'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>B
[2005] [2006] [2007] [2008] 
   2.7    1.8    1.6    1.3 </code></pre>
</div>
</div>
<p>Finally, the option <code>SLICE =</code> is useful to select a single level across other dimensions (and drop the selected dimension).</p>
<p>Without <code>SLICE =</code>, we retain the dimensions of the original offarray:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>oasmp[<span class="dv">2012</span>, <span class="dv">2005</span><span class="sc">:</span><span class="dv">2007</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         B
Y         [,2005] [,2006] [,2007]
  [2012,]     0.3     0.8     0.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(oasmp[<span class="dv">2012</span>, <span class="dv">2005</span><span class="sc">:</span><span class="dv">2007</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Y B 
1 3 </code></pre>
</div>
</div>
<p>With <code>SLICE =</code>, the selected dimension gets dropped from the returned offarray:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>oasmp[SLICE<span class="ot">=</span><span class="dv">2012</span>, <span class="dv">2005</span><span class="sc">:</span><span class="dv">2007</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>B
[2005] [2006] [2007] 
   0.3    0.8    0.4 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(oasmp[<span class="at">SLICE=</span><span class="dv">2012</span>, <span class="dv">2005</span><span class="sc">:</span><span class="dv">2007</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>B 
3 </code></pre>
</div>
</div>
</section>
</section>
<section id="autoloop" class="level1">
<h1>Autoloop</h1>
<p><code>autoloop</code> is a function designed to loop over all the cells within an <code>autoarray</code>. It is essentially a shortcut to the familiar <code>for (i %in% 1:x) ...</code> base R syntax which is especially handy when multiple nested loops have to be implemented.</p>
<p>To use it specify vectors of values to be looped over (one or more) and the expression evaluated for each iteration of the loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>oalp <span class="ot">&lt;-</span> <span class="fu">autoloop</span>(<span class="at">Y=</span><span class="dv">2012</span><span class="sc">:</span><span class="dv">2013</span>, <span class="at">B=</span><span class="dv">2006</span><span class="sc">:</span><span class="dv">2008</span>, {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    oasmp[Y, B] <span class="sc">*</span> <span class="dv">3</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The returned object will have class <code>offarray</code> and be of dimensions matching the input vectors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimseq</span>(oalp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Y
[1] 2012 2013

$B
[1] 2006 2007 2008</code></pre>
</div>
</div>
</section>
<section id="environments" class="level1">
<h1>Environments</h1>
<p>Environment are special R objects that store other objects and dictate what happens when the name of an object is mapped to its corresponding content. We will only review them here as it pertains to their usage in the CKMR exercises, but <a href="https://colinfay.me/explain-environments-eli5/">this</a> and <a href="https://blog.thatbuthow.com/how-r-searches-and-finds-stuff/">this</a> are good resources if you are interested to learn more about lexical scoping.</p>
<p>The main environment is <code>.GlobalEnv</code> which is the global environment that the R console operates in. When you create an object directly in the R console you assign it to the global environment.</p>
<p>When a function is executed it will first look for objects in its local environment, then in its parent environment (often the global environment). The value of the object in the function’s environment will take precedence over that in the parent environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>zap <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>pzap <span class="ot">&lt;-</span> <span class="cf">function</span>() { zap <span class="ot">&lt;-</span> <span class="fl">7.1</span>; <span class="fu">print</span>(zap) }</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pzap</span>() <span class="co"># 7.1, not 8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.1</code></pre>
</div>
</div>
<p>A function can only find an object if it’s been defined in the function environment or in its parent environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pzoup <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="fu">print</span>(zoup)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pzoup</span>() <span class="co"># bug</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can manually assign an environment to a function, and store objects in there:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>myenv <span class="ot">&lt;-</span> <span class="fu">new.env</span>()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>myenv<span class="sc">$</span>zoup <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>pzoup <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="fu">print</span>(zoup)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(pzoup) <span class="ot">&lt;-</span> myenv</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pzoup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>Finally, you need to explicity assign objects to the function’s environment for them to be accessible outside of the function (e.g., in the R console once the function has executed):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>pzoup <span class="ot">&lt;-</span> <span class="cf">function</span>() xx <span class="ot">&lt;-</span> zoup <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(pzoup) <span class="ot">&lt;-</span> myenv</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(myenv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "zoup"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pzoup</span>() <span class="co"># execute pzoup, xx=8 gets create within</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(myenv) <span class="co"># xx has not been added to myenv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "zoup"</code></pre>
</div>
</div>
<p>There are a few different ways to explicity assign objects to environments. The example below uses the function <code>assign</code> but the CKMR code will often use <code>list2env</code> with <code>mget</code> to assign the value of multiple objects to the function’s environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pzoup <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    xx <span class="ot">&lt;-</span> zoup <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(<span class="st">'xx'</span>, xx, <span class="at">envir=</span><span class="fu">environment</span>( <span class="fu">sys.function</span>()))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(pzoup) <span class="ot">&lt;-</span> myenv</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(myenv) <span class="co"># only zoup</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "zoup"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pzoup</span>() <span class="co"># execute pzoup, xx=8 gets create within</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>(myenv) <span class="co"># xx has joined the chat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "xx"   "zoup"</code></pre>
</div>
</div>
</section>
<section id="common-errors" class="level1">
<h1>Common errors</h1>
<section id="turning-off-the-byte-compiler" class="level2">
<h2 class="anchored" data-anchor-id="turning-off-the-byte-compiler">Turning-off the byte compiler</h2>
<p>If you see this error message…</p>
<p><code>Error in eval(mc, eee) : object '*tmp*' not found</code></p>
<p>… you have most likely not turned off the byte compiler. <code>source("turn_off_bc.r")</code> and try again.</p>
</section>
<section id="atease" class="level2">
<h2 class="anchored" data-anchor-id="atease">atease</h2>
<p>If you see this error message…</p>
<p><code>Error in extract.named(sampo@public) :</code> <code>trying to get slot "public" from an object of a basic class ("list") with no slots</code></p>
<p>The <code>atease</code> library was probably not loaded, or was loaded after the exercise functions were defined. Load it, then re-source <code>ckmr_funs.r</code>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>